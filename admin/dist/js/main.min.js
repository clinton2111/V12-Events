(function(){angular.module("V12Admin",["ui.router","V12Admin.authentication","angular-md5","satellizer","ngStorage","V12Admin.dashBoardCtrl","ngFileUpload"]).config(["$stateProvider","$urlRouterProvider","$httpProvider","$locationProvider","$authProvider","API",function(a,b,c,d,e,f){return a.state("auth",{url:"/auth/:type/:email/:value",templateUrl:f.views+"auth.html",controller:"authController"}).state("dashboard",{url:"/dashboard","abstract":!0,templateUrl:f.views+"dashboard.html",controller:"dashBoardController",data:{requiresLogin:!0}}).state("dashboard.home",{url:"",templateUrl:f.views+"dashboardHome.html",data:{requiresLogin:!0}}).state("dashboard.photos",{url:"/photos",templateUrl:f.views+"dashboardPhotos.html",controller:"dashBoardPhotosController",data:{requiresLogin:!0}}),b.otherwise("/auth"),b.when("dashboard","dashboard.home"),b.otherwise("/auth/login//"),e.loginUrl=f.url+"auth.php",e.tokenPrefix="v12events"}]).constant("API",{url:"../api/",views:"/admin/src/views/"}).run(["$rootScope","$state","$http","API","$q","$auth","$localStorage",function(a,b,c,d,e,f,g){return a.$on("$stateChangeStart",function(a,h){var i,j,k;if(j=function(){var a;return a=e.defer(),c.post(d.url+"refreshToken.php",null).then(function(b){return a.resolve(b.data)},function(b){return console.log("Error"),a.reject(data)}),a.promise},h.data&&h.data.requiresLogin){if(f.isAuthenticated()===!1)return a.preventDefault(),b.go("auth",{type:"login",email:null,value:null});if(i=null,i=_.isUndefined(g.resetDate)===!0?moment("21-11-1992","DD-MM-YYYY"):moment(g.resetDate,"DD-MM-YYYY"),k=moment().isSame(moment(i),"day"),!k)return j().then(function(c){var d;return d=c,_.isNull(d.token)&&_.isUndefined(d.token)?(a.preventDefault(),b.go("auth",{type:"login",email:null,value:null})):(f.setToken(d.token),g.resetDate=moment().format("DD-MM-YYYY"))},function(b){return a.preventDefault()})}})}])}).call(this),function(){angular.module("V12Admin.authentication",[]).controller("authController",["$scope","$stateParams","md5","authFactory","$auth","$state","$localStorage",function(a,b,c,d,e,f,g){return"recovery"!==b.type||_.isUndefined(b.value)||_.isUndefined(b.email)?(a.recovery_screen=!1,a.header="Login"):(a.recovery_screen=!0,a.header="Reset Password"),a.forgotPassword=!1,a.viewPass=!1,a.passType="password",a.passIcon="mdi-action-visibility-off",a.toggleShowPassword=function(){return a.viewPass===!1?(a.viewPass=!0,a.passType="text",a.passIcon="mdi-action-visibility"):(a.viewPass=!1,a.passType="password",a.passIcon="mdi-action-visibility-off")},a.login=function(a){var b;return b={email:a.email,password:c.createHash(a.password||""),type:"login"},e.login(b,[{skipAuthorization:!0}]).then(function(a){var b;return b=a.data,g.resetDate=moment().format("DD-MM-YYYY"),Materialize.toast(b.message,"4000"),f.go("dashboard.home")},function(a){return Materialize.toast(a.data.message,"4000")})},a.recoverPassword=function(a){return d.recoverPassword(a).then(function(a){var b;return b=a.data,Materialize.toast(b.message,4e3)},function(a){return Materialize.toast(a.data.message,4e3)})},a.toggleForgotPass=function(){return a.forgotPassword===!1?(a.forgotPassword=!0,a.header="Recover Password"):(a.forgotPassword=!1,a.header="Login")},a.updatePassword=function(a){var e;return a.password===a.cpassword?(e={password:c.createHash(a.password||""),email:b.email,value:b.value},d.updatePassword(e).then(function(a){var b;return b=a.data,Materialize.toast(b.status+" - "+b.message,4e3),f.go("auth",{type:"login",email:null,value:null})},function(a){return Materialize.toast("Opps something went wrong",4e3)})):Materialize.toast("Passwords do not match",4e3)}}])}.call(this),function(){angular.module("V12Admin.dashBoardCtrl",[]).controller("dashBoardController",["$scope","$state","$auth","$localStorage",function(a,b,c,d){var e;return a.$on("$viewContentLoaded",function(){return $(".button-collapse").sideNav({menuWidth:300,closeOnClick:!0})}),e=c.getPayload(),a.username=e.name,a.logout=function(){return c.logout(),delete d.resetDate,b.go("auth",{type:"login",email:null,value:null}),Materialize.toast("You have been logged out",4e3)}}])}.call(this),function(){angular.module("V12Admin.dashBoardCtrl").controller("dashBoardPhotosController",["$scope","dashBoardPhotosService",function(a,b){var c;return a.$on("$viewContentLoaded",function(){return $(".modal-trigger").leanModal()}),c=0,a.photos=[],a.picPaths={main_image:"../assets/photos/",thumbnails:"../assets/thumbnails/"},a.fetchPhotos=function(c){return 0===c&&(a.photos=[]),b.fetchPhotos(c).then(function(b){var c;return 204===b.status?Materialize.toast("No photos to load",4e3):(c=b.data,a.photos=c.results)},function(a){return Materialize.toast("Something went wrong",4e3)})},a.loadMore=function(){return c=a.photos.length,a.fetchPhotos(c)},a.openModal=function(b,c){var d,e;return e=_.findIndex(a.photos,{id:b}),"caption"===c?(d=a.photos[e].caption,""===d&&(d=null),a.currentPic={Caption:d,Id:b},$("#updateCaption").openModal()):void 0},a.deletePhoto=function(c){var d,e;return e=_.findIndex(a.photos,{id:c}),d={id:c,name:a.photos[e].image_name},b.deletePhoto(d).then(function(b){var c;return c=b.data,a.photos.splice(e,1),Materialize.toast(c.status+" - "+c.message,4e3)},function(a){return Materialize.toast("Something went wrong",4e3)})},a.uploadPhoto=function(c){return b.uploadPhoto(c).then(function(b){var d;return d=b.data,"Success"===d.status?(a.photos.unshift({id:d.id,caption:c.Caption,photo_image:d.imageName}),a.pic=angular.copy({}),Materialize.toast(d.status+" - "+d.message,4e3)):Materialize.toast(d.status+" - "+d.message,4e3)},function(a){return Materialize.toast("Something went wrong",4e3)})},a.updateCaption=function(c){var d,e,f;return e=_.findIndex(a.photos,{id:c}),f=a.currentPic.Caption,d={caption:f,id:c},b.updateCaption(d).then(function(b){var c;return c=b.data,"Success"===c.status?(a.photos[e].caption=f,Materialize.toast(c.status+" - "+c.message,4e3)):Materialize.toast(c.status+" - "+c.message,4e3)},function(a){return Materialize.toast("Something went wrong",4e3)})},a.$watchCollection(["photos","gigs"],function(){return a.$apply},!1)}])}.call(this),function(){angular.module("V12Admin.authentication").factory("authFactory",["$http","$q","API",function(a,b,c){return{recoverPassword:function(d){var e;return d.type="recoverPassword",e=b.defer(),a({url:c.url+"auth.php",method:"POST",data:d,skipAuthorization:!0}).then(function(a){return e.resolve(a)},function(a){return e.reject(a)}),e.promise},updatePassword:function(d){var e;return d.type="updatePassword",e=b.defer(),a({url:c.url+"auth.php",method:"POST",data:d,skipAuthorization:!0}).then(function(a){return e.resolve(a)},function(a){return e.reject(a)}),e.promise}}}])}.call(this),function(){angular.module("V12Admin.dashBoardCtrl").factory("dashBoardPhotosService",["$http","$q","API","Upload",function(a,b,c,d){return{fetchPhotos:function(d){var e;return e=b.defer(),a({url:c.url+"photoHandler.php",data:{location:"fetch_photos",offset:d},method:"post",cache:!0}).then(function(a){return e.resolve(a)},function(a){return e.reject(a)}),e.promise},uploadPhoto:function(a){var e;return e=b.defer(),d.upload({url:c.url+"photoHandler.php",data:{caption:a.Caption,location:"insert_photos"},method:"POST",headers:{"Content-Type":a.File.type},file:a.File}).then(function(a){return e.resolve(a)},function(a){return e.reject(a)}),e.promise},updateCaption:function(d){var e;return d.location="update_caption",e=b.defer(),a({url:c.url+"photoHandler.php",data:d,method:"post"}).then(function(a){return e.resolve(a)},function(a){return e.reject(a)}),e.promise},deletePhoto:function(d){var e;return d.location="delete_photo",e=b.defer(),a({url:c.url+"photoHandler.php",data:d,method:"post"}).then(function(a){return e.resolve(a)},function(a){return e.reject(a)}),e.promise}}}])}.call(this);